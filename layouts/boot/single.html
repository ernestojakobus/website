{{- /* layouts/touren/single.html */ -}}
{{ define "main" }}

<article class="tour-detail-wrapper reveal">

  <!-- Titel + Meta -->
  <header class="tour-header">
    <h1>{{ .Title }}</h1>
    {{ with .Date }}<p class="tour-date">{{ .Format "02.01.2006" }}</p>{{ end }}

    {{- $dist := or .Params.distancia .Params.strecke -}}
    {{- $dura := or .Params.duracion  .Params.dauer   -}}
    {{- $desta:= or .Params.destacado .Params.highlight -}}

    <div class="tour-meta">
      {{ with $dist  }}<span class="meta-item"><strong>Distancia:</strong> {{ . }}</span>{{ end }}
      {{ with $dura  }}<span class="meta-item"><strong>Duración:</strong>  {{ . }}</span>{{ end }}
      {{ with $desta }}<span class="meta-item"><strong>Destacado:</strong> {{ . }}</span>{{ end }}
    </div>
  </header>

  <!-- Galerie (nimmt gallery:, sonst optional image:) -->
  {{- $gal := .Params.gallery -}}
  {{- if (not $gal) -}}
    {{- with .Params.image -}}
      {{- $gal = (slice .) -}}
    {{- end -}}
  {{- end -}}

  {{ if and $gal (gt (len $gal) 0) }}
    <section class="gallery-card reveal">
      <div class="tour-gallery-wrapper" data-gallery>
        <div class="gallery-slides">
          {{ range $i, $img := $gal }}
            {{ $src := (printf "%s" (trim $img "/")) | relURL }}
            <div class="gallery-slide {{ if eq $i 0 }}is-active{{ end }}">
              <img
                class="tour-gallery-img"
                src="{{ $src }}"
                alt="{{ $.Title }} – imagen {{ add $i 1 }}"
                loading="lazy"
                onerror="this.onerror=null;this.src='{{ "images/placeholder.jpg" | relURL }}'">
            </div>
          {{ end }}
        </div>

        <button class="gallery-prev" type="button" aria-label="Anterior">‹</button>
        <button class="gallery-next" type="button" aria-label="Siguiente">›</button>

        <div class="gallery-dots">
          {{ range $i, $_ := $gal }}
            <button class="gallery-dot {{ if eq $i 0 }}is-active{{ end }}"
                    data-index="{{ $i }}" aria-label="Ir a {{ add $i 1 }}"></button>
          {{ end }}
        </div>
      </div>
    </section>
  {{ end }}

  <!-- Fließtext in Karte -->
  <div class="bar-card">
    <div class="content">
      {{ .Content }}
    </div>
  </div>

  <p class="tour-back">
    <a class="button" href="{{ "touren/" | relLangURL }}">← Volver a Tours</a>
  </p>
</article>

{{ end }}
